<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Assistant Vocal v0.2</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    background: #121212;
    color: #eee;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
  }
  #login, #app {
    display: none;
    flex-direction: column;
    background: #222;
    padding: 30px;
    border-radius: 12px;
    width: 320px;
    box-shadow: 0 0 10px #000;
    text-align: center;
  }
  input[type="password"] {
    padding: 10px;
    font-size: 1.2rem;
    margin-bottom: 15px;
    border: none;
    border-radius: 6px;
    width: 100%;
  }
  button {
    padding: 12px;
    font-size: 1.1rem;
    background: #008cff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  button:hover {
    background: #006dcc;
  }
  #status {
    margin-top: 20px;
    min-height: 1.5em;
    white-space: pre-wrap;
  }
  #version {
    position: absolute;
    bottom: 10px;
    font-size: 0.9rem;
    color: #888;
    text-align: center;
    width: 100%;
    user-select: none;
  }
</style>
</head>
<body>

<div id="login">
  <h2>Code d'acc√®s</h2>
  <input type="password" id="pass" placeholder="Entrer le code" autocomplete="off" />
  <button id="loginBtn">Valider</button>
  <div id="error" style="color:red; margin-top:10px;"></div>
</div>

<div id="app">
  <button id="startBtn">D√©marrer</button>
  <div id="status">En attente...</div>
</div>

<div id="version">Version 0.2</div>

<script>
  const login = document.getElementById("login");
  const app = document.getElementById("app");
  const pass = document.getElementById("pass");
  const error = document.getElementById("error");
  const loginBtn = document.getElementById("loginBtn");
  const startBtn = document.getElementById("startBtn");
  const statusDiv = document.getElementById("status");

  let recognition;
  let running = false;

  login.style.display = "flex";

  loginBtn.onclick = () => {
    if (pass.value === "8629") {
      login.style.display = "none";
      app.style.display = "flex";
      error.textContent = "";
    } else {
      error.textContent = "Code incorrect.";
    }
  };

  function startRecognition() {
    if (!running) return;

    if (!recognition) {
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        alert("Reconnaissance non support√©e");
        running = false;
        startBtn.textContent = "D√©marrer";
        return;
      }
      recognition = new SR();
      recognition.lang = "fr-FR";
      recognition.interimResults = false;
      recognition.continuous = true;

      recognition.onstart = () => {
        statusDiv.textContent = "üé§ Micro activ√©, parlez...";
      };

      recognition.onresult = (event) => {
        const last = event.results.length - 1;
        const transcript = event.results[last][0].transcript.trim();
        statusDiv.textContent = `üó£Ô∏è "${transcript}"`;
      };

      recognition.onerror = (event) => {
        statusDiv.textContent = "‚ùå Erreur : " + event.error;
        running = false;
        startBtn.textContent = "D√©marrer";
      };

      recognition.onend = () => {
        if (running) {
          statusDiv.textContent += "\n(Red√©marrage de la reconnaissance...)";
          recognition.start();
        }
      };
    }

    recognition.start();
  }

  startBtn.onclick = () => {
    if (!running) {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(() => {
          running = true;
          startBtn.textContent = "Arr√™ter";
          startRecognition();
        })
        .catch(err => {
          alert("Erreur micro : " + err.message);
        });
    } else {
      running = false;
      startBtn.textContent = "D√©marrer";
      if (recognition) {
        recognition.stop();
      }
      statusDiv.textContent = "En pause.";
    }
  };
</script>

</body>
</html>
